# åŸºäºæ·±åº¦å­¦ä¹ çš„é“¶è¡Œå¡å·è¯†åˆ«

**ç›®å½• (Table of Contents)**

[TOCM]

[TOC]

## é¡¹ç›®å®ç°æŠ€æœ¯æ ˆä»‹ç»
### å¼€å‘è½¯ä»¶
> Visual Studio 2017

### å¼€å‘è¯­è¨€
> python3.6

### ä½¿ç”¨æ¡†æ¶
> Keras2.2.4ã€opencv-python3.3.0.10ã€tensorflow1.13.1

### ä½¿ç”¨ç®—æ³•
> CTPNã€CRNN

## é¡¹ç›®å®ç°æ€è·¯ä»‹ç»
### æ•´ä½“å®ç°æ€è·¯
#### é“¶è¡Œå¡å·å®šä½å®ç°
> 1. é¦–å…ˆï¼Œç”¨ VGG16 çš„å‰ 5 ä¸ª Conv stage å¾—åˆ° feature mapï¼Œå¤§å°ä¸º  W*H*C
> 2. ç”¨ 3*3 çš„æ»‘åŠ¨çª—å£åœ¨å‰ä¸€æ­¥å¾—åˆ°çš„ feature map ä¸Šæå–ç‰¹å¾ï¼Œåˆ©ç”¨è¿™äº›ç‰¹å¾æ¥å¯¹å¤šä¸ª anchor è¿›è¡Œé¢„æµ‹,è¿™é‡Œ > anchor å®šä¹‰ä¸ä¹‹å‰ faster-rcnn ä¸­çš„å®šä¹‰ç›¸åŒï¼Œä¹Ÿå°±æ˜¯å¸®æˆ‘ä»¬å»ç•Œå®šå‡ºç›®æ ‡å¾…é€‰åŒºåŸŸã€‚
> 3. å°†ä¸Šä¸€æ­¥å¾—åˆ°çš„ç‰¹å¾è¾“å…¥åˆ°ä¸€ä¸ªåŒå‘çš„ LSTM ä¸­ï¼Œè¾“å‡º W*256 çš„ç»“æœï¼Œå†å°†è¿™ä¸ªç»“æœè¾“å…¥åˆ°ä¸€ä¸ª 512 ç»´çš„> å…¨è¿æ¥å±‚ï¼ˆFCï¼‰.
>4. æœ€åé€šè¿‡åˆ†ç±»æˆ–å›å½’å¾—åˆ°çš„è¾“å‡ºä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œæ ¹æ®ä¸Šå›¾ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸º 2k vertical coordinates:è¡¨ç¤ºé€‰æ‹©æ¡†çš„é«˜åº¦å’Œä¸­å¿ƒçš„ y è½´çš„åæ ‡ï¼›2k scores:è¡¨ç¤º çš„æ˜¯ k ä¸ª anchor çš„ç±»åˆ«ä¿¡æ¯ï¼Œè¯´æ˜å…¶æ˜¯å¦ä¸ºå­—ç¬¦ï¼› k side-refinement è¡¨ç¤ºçš„æ˜¯ é€‰æ‹©æ¡†çš„æ°´å¹³åç§»é‡ã€‚æœ¬æ–‡å®éªŒä¸­ anchor çš„æ°´å¹³å®½åº¦éƒ½æ˜¯ 16 ä¸ªåƒç´ ä¸å˜ï¼Œ ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¾®åˆ†çš„æœ€å°é€‰æ‹©æ¡†çš„å•ä½æ˜¯ â€œ16 åƒç´ â€ã€‚
>5. ç”¨æ–‡æœ¬æ„é€ çš„ç®—æ³•ï¼Œå°†æˆ‘ä»¬å¾—åˆ°çš„ç»†é•¿çš„çŸ©å½¢ï¼Œç„¶åå°†å…¶åˆå¹¶ æˆæ–‡æœ¬çš„åºåˆ—æ¡†

#### ä¸å®šé•¿é“¶è¡Œå¡å·è¯†åˆ«å®ç°
> 1.ä¼ ç»Ÿçš„ocrè¯†åˆ«è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼šå•å­—åˆ‡å‰²å’Œåˆ†ç±»ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå°†ä¸€è¿ä¸²æ–‡å­—çš„æ–‡æœ¬æ–‡ä»¶å…ˆåˆ©ç”¨æŠ•å½±æ³•åˆ‡å‰²å‡ºå•ä¸ªå­—ä½“ï¼Œåœ¨é€å…¥CNNé‡Œè¿›è¡Œæ–‡å­—åˆ†ç±»ã€‚ä½†æ˜¯é€šè¿‡ctpnç®—æ³•å®šä½åˆ°çš„å¡å·å›¾ç‰‡æ–‡æœ¬é•¿åº¦ä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼åŠ å…¥æ–‡å­—åˆ‡å‰²è¿™ä¸ªç¯èŠ‚ï¼Œè€Œæ˜¯å°†æ–‡å­—è¯†åˆ«è½¬åŒ–ä¸ºåºåˆ—å­¦ä¹ é—®é¢˜ï¼Œè™½ç„¶è¾“å…¥çš„å›¾åƒå°ºåº¦ä¸åŒï¼Œæ–‡æœ¬é•¿åº¦ä¸åŒï¼Œä½†æ˜¯ç»è¿‡DCNNå’ŒRNNåï¼Œåœ¨è¾“å‡ºé˜¶æ®µç»è¿‡ä¸€å®šçš„ç¿»è¯‘åï¼Œå°±å¯ä»¥å¯¹æ•´ä¸ªæ–‡æœ¬å›¾åƒè¿›è¡Œè¯†åˆ«ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡å­—çš„åˆ‡å‰²ä¹Ÿè¢«èå…¥åˆ°æ·±åº¦å­¦ä¹ ä¸­å»äº†ã€‚
>2.CRNNç®—æ³•æ˜¯æŠŠCNNåšå›¾åƒç‰¹å¾å·¥ç¨‹çš„æ½œåŠ›ä¸LSTMåšåºåˆ—åŒ–è¯†åˆ«çš„æ½œåŠ›ï¼Œè¿›è¡Œç»“åˆã€‚å®ƒæ—¢æå–äº†é²æ£’ç‰¹å¾ï¼Œåˆé€šè¿‡åºåˆ—è¯†åˆ«é¿å…äº†ä¼ ç»Ÿç®—æ³•ä¸­éš¾åº¦æé«˜çš„å•å­—ç¬¦åˆ‡åˆ†ä¸å•å­—ç¬¦è¯†åˆ«ï¼ŒåŒæ—¶åºåˆ—åŒ–è¯†åˆ«ä¹ŸåµŒå…¥æ—¶åºä¾èµ–ï¼ˆéšå«åˆ©ç”¨è¯­æ–™ï¼‰ã€‚åœ¨è®­ç»ƒé˜¶æ®µï¼ŒCRNNå°†è®­ç»ƒå›¾åƒç»Ÿä¸€ç¼©æ”¾100Ã—32ï¼ˆw Ã— hï¼‰ï¼›åœ¨æµ‹è¯•é˜¶æ®µï¼Œé’ˆå¯¹å­—ç¬¦æ‹‰ä¼¸å¯¼è‡´è¯†åˆ«ç‡é™ä½çš„é—®é¢˜ï¼ŒCRNNä¿æŒè¾“å…¥å›¾åƒå°ºå¯¸æ¯”ä¾‹ï¼Œä½†æ˜¯å›¾åƒé«˜åº¦è¿˜æ˜¯å¿…é¡»ç»Ÿä¸€ä¸º32ä¸ªåƒç´ ï¼Œå·ç§¯ç‰¹å¾å›¾çš„å°ºå¯¸åŠ¨æ€å†³å®šLSTMæ—¶åºé•¿åº¦ã€‚
#### æ•°æ®å¢å¼ºæ–¹å¼
#### æ•°æ®å¤„ç†æ–¹å¼
## é¡¹ç›®å®ç°æµç¨‹ä»‹ç»
### å¡å·å®šä½
#### Detecting Text in Fine-scale proposalsï¼ˆé€‰æ‹©å‡º anchorï¼Œ ä¹Ÿå°±æ˜¯å¾…é€‰çš„â€çŸ©å½¢å¾®åˆ†æ¡†â€œï¼‰
> å’Œ  faster-rcnn ä¸­çš„ RPN çš„ä¸»è¦åŒºåˆ«åœ¨äºå¼•å…¥äº†â€å¾®åˆ†â€œæ€æƒ³ï¼Œå°†æˆ‘ä»¬çš„çš„å€™é€‰åŒºåŸŸ åˆ‡æˆé•¿æ¡å½¢çš„æ¡†æ¥è¿›è¡Œå¤„ç†ã€‚k ä¸ª anchorï¼ˆä¹Ÿå°±æ˜¯ k ä¸ªå¾…é€‰çš„é•¿æ¡é¢„é€‰åŒºåŸŸï¼‰çš„è®¾ç½®å¦‚ ä¸‹ï¼šå®½åº¦éƒ½æ˜¯ 16 åƒç´ ï¼Œé«˜åº¦ä» 11~273 åƒç´ å˜åŒ–ï¼ˆæ¯æ¬¡ä¹˜ä»¥ 1.4ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ k çš„å€¼è®¾å®šä¸º 10ã€‚æœ€åç»“æœå¦‚ä¸‹ï¼š 

![ "å¾®åˆ†"ç¤ºæ„å›¾](https://github.com/amtls/MyImages/blob/master/%E5%9B%BE%E7%89%871.jpg?raw=true)
#### Recurrent Connectionist Text Proposalsï¼ˆåŒå‘ LSTMï¼Œåˆ© ç”¨ä¸Šä¸‹æ–‡æœ¬ä¿¡æ¯çš„ RNN è¿‡ç¨‹ï¼‰
> æœ¬æ–‡ä½¿ç”¨çš„æ–¹æ³•å›å½’å‡ºæ¥çš„ y è½´åæ ‡ç»“æœå¦‚ä¸‹ï¼š 

$$v_c = (c_y - c^a _y)/h^a$$

$$v_h = log(h/h^a)$$

$$c^*_c = (c^*_y - c^a_y)/h^a$$

$$v^*_h = log(h^*/h^a)$$
>å…¶ä¸­æ ‡è®°*çš„è¡¨ç¤ºä¸ºçœŸå€¼ï¼› v = {vc,vh } è¡¨ç¤ºä¸€ä¸ªé¢„æµ‹çš„æ¡†é€‰ä½ç½®ï¼Œå› ä¸ºé•¿åº¦å›ºå®šï¼ˆä¹‹å‰ç¡®å®šçš„16åƒç´ ï¼‰ï¼Œvcè¡¨ç¤ºçš„æ˜¯è¯¥é¢„é€‰æ¡†åœ¨yè½´ä¸Šçš„ä¸­å¿ƒä½ç½®ï¼Œvhè¡¨ç¤ºè¿™ä¸ªé¢„é€‰æ¡†çš„é«˜åº¦ã€‚ 
> å…¶æ–¹æ³•å¯¹åº”çš„å°±æ˜¯ä¹‹å‰æµç¨‹ä¸­çš„â€åŒå‘LSTMâ€œå¯¹åº”çš„ç»†èŠ‚ï¼Œå°†å‰åæ–‡çš„ä¿¡æ¯ç”¨åˆ° æ–‡æœ¬ä½ç½®çš„å®šä½å½“ä¸­ã€‚å…¶ä¸­BLSTMæœ‰128ä¸ªéšå«å±‚ã€‚è¾“å…¥ä¸º3*3*Cæ»‘åŠ¨çª—å£çš„featureï¼Œè¾“ å‡ºä¸ºæ¯ä¸ªçª—å£æ‰€å¯¹åº”çš„256ç»´çš„ç‰¹å¾ã€‚ç®€è¦è¡¨ç¤ºå¦‚ä¸‹:

![Diagram](https://github.com/amtls/MyImages/blob/master/%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA.png?raw=true)

#### Side-refinementï¼ˆæ–‡æœ¬æ„é€ ï¼Œå°†å¤šä¸ª proposal åˆå¹¶æˆç›´ çº¿ï¼‰
>å…ˆè¿›è¡Œæ–‡æœ¬ä½ç½®çš„æ„é€ ï¼ŒSide-refinementæ˜¯æœ€åè¿›è¡Œä¼˜åŒ–çš„æ–¹æ³•ã€‚å¯¹å®šä½å‡ºæ¥çš„ â€œå°çŸ©å½¢æ¡†â€åŠ ä»¥åˆå¹¶å’Œå½’çº³ï¼Œå¯ä»¥å¾—åˆ°éœ€è¦çš„æ–‡æœ¬ä¿¡æ¯çš„ä½ç½®ä¿¡æ¯ã€‚æˆ‘ä»¬æœ€åä¿ç•™çš„ å°çŸ©å½¢æ¡†æ˜¯éœ€è¦score>0.7çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å°†ä¸‹å›¾ä¸­çš„çº¢è‰²å°çŸ©å½¢æ¡†åˆå¹¶ï¼Œæœ€åç”Ÿæˆé»„è‰² çš„å¤§çŸ©å½¢æ¡†
>
![å°åŒºåŸŸåˆ†å‰²ç¤ºæ„å›¾](https://github.com/amtls/MyImages/blob/master/%E5%9B%BE%E7%89%872.jpg?raw=true)
>ä¸»è¦çš„æ€è·¯ä¸ºï¼šæ¯ä¸¤ä¸ªç›¸è¿‘çš„proposalï¼ˆä¹Ÿå°±æ˜¯å€™é€‰åŒºï¼‰ç»„æˆä¸€ä¸ª pairï¼Œåˆå¹¶ä¸åŒ
çš„ pairç›´åˆ°æ— æ³•å†åˆå¹¶ä¸ºæ­¢ã€‚è€Œåˆ¤æ–­ä¸¤ä¸ªproposal,Biå’ŒBjå¯ä»¥ç»„æˆä¸€ä¸ªpairçš„æ¡ä»¶ä¸ºBiâ€”  >Bj,åŒæ—¶Bjâ€”>Bi;è¯¥ç¬¦å·çš„åˆ¤å®šæ¡ä»¶è§ä¸‹å›¾ã€‚

![Diagram](https://github.com/amtls/MyImages/blob/master/%E5%8F%AF%E5%90%88%E5%B9%B6%E5%8C%BA%E5%9F%9F.png?raw=true)
>å› ä¸ºè¿™é‡Œè§„å®šäº†å›å½’å‡ºæ¥çš„boxçš„å®½åº¦æ˜¯16ä¸ªåƒç´ ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ä¸€äº›ä½ç½®ä¸Šçš„è¯¯ å·®ï¼Œè¿™æ—¶å€™å°±æ˜¯Side-refinementå‘æŒ¥ä½œç”¨çš„æ—¶å€™ äº†ã€‚å®šä¹‰çš„å¼å­å¦‚ä¸‹ï¼š 

$$O = (x_{side} -c^a_x)/w^a$$

$$o^*=(x^*_{side})/w^a$$
>å…¶ä¸­å¸¦*è¡¨ç¤ºä¸ºGroundTruth.ã€‚ğ‘¥ğ‘¥ğ‘ ğ‘ ğ‘–ğ‘–ğ‘‘ğ‘‘ ğ‘’ğ‘’ è¡¨ç¤ºå›å½’å‡ºæ¥çš„å·¦è¾¹ç•Œæˆ–è€…å³è¾¹ç•Œï¼Œğ‘ğ‘ ğ‘ğ‘ è¡¨ç¤º anchor ä¸­å¿ƒçš„æ¨ªåæ ‡ï¼Œğ‘¤ğ‘¤ğ‘ğ‘æ˜¯å›ºå®šçš„å®½åº¦16åƒç´ ã€‚æ‰€ä»¥Oçš„å®šä¹‰ç›¸å½“äºæ˜¯ä¸€ä¸ªç¼©æ”¾çš„æ¯”ä¾‹ï¼Œ å¸®åŠ©æˆ‘ä»¬å»æ‹‰ä¼¸å›å½’ä¹‹åçš„boxçš„ç»“æœï¼Œä»è€Œæ›´å¥½åœ°ç¬¦åˆå®é™…æ–‡æœ¬çš„ä½ç½®ã€‚çºµè§‚æ•´ä¸ªæµç¨‹ï¼Œè¯¥æ–¹æ³•çš„æœ€å¤§ä¸¤ç‚¹ä¹Ÿæ˜¯åœ¨äºå°†RNNå¼•å…¥äº†æ–‡æœ¬æ£€æµ‹ä¹‹ä¸­ï¼ŒåŒæ—¶å°† å¾…æ£€æµ‹çš„ç»“æœåˆ©ç”¨â€œå¾®åˆ†â€çš„æ€è·¯æ¥å‡å°‘è¯¯å·®ï¼Œä½¿ç”¨å›ºå®šå®½åº¦çš„anchoræ¥æ£€æµ‹åˆ†å‰²æˆ è®¸å¤šå—çš„proposal.æœ€ååˆå¹¶ä¹‹åçš„åºåˆ—å°±æ˜¯æˆ‘ä»¬éœ€è¦æ£€æµ‹çš„æ–‡æœ¬åŒºåŸŸã€‚
### å¡å·è¯†åˆ«
#### è¯†åˆ«æµç¨‹ï¼š
>Â·é¦–å…ˆä¼šå°†å›¾åƒç¼©æ”¾åˆ° 32Ã—WÃ—1 å¤§å°
Â·ç„¶åç»è¿‡CNNåå˜ä¸º 1Ã—ï¼ˆW/4ï¼‰Ã— 512
Â·æ¥ç€é’ˆå¯¹LSTMï¼Œè®¾ç½® T=(W/4) ï¼Œ D=512 ï¼Œå³å¯å°†ç‰¹å¾è¾“å…¥LSTMã€‚
Â·LSTMæœ‰256ä¸ªéšè—èŠ‚ç‚¹ï¼Œç»è¿‡LSTMåå˜ä¸ºé•¿åº¦ä¸ºT Ã— nclassçš„å‘é‡ï¼Œå†ç»è¿‡softmaxå¤„ç†ï¼Œåˆ—å‘é‡æ¯ä¸ªå…ƒç´ ä»£è¡¨å¯¹åº”çš„å­—ç¬¦é¢„æµ‹æ¦‚Â·ç‡ï¼Œæœ€åå†å°†è¿™ä¸ªTçš„é¢„æµ‹ç»“æœå»å†—ä½™åˆå¹¶æˆä¸€ä¸ªå®Œæ•´è¯†åˆ«ç»“æœå³å¯ã€‚

![enter description here]()
#### ç½‘ç»œç»“æ„ï¼š
![RCNNç½‘ç»œç»“æ„](https://github.com/amtls/MyImages/blob/master/%E6%9C%AA%E6%A0%87%E9%A2%98-2.jpg?raw=true)
>1.å·ç§¯å±‚ï¼Œä½¿ç”¨CNNï¼Œä½œç”¨æ˜¯ä»è¾“å…¥å›¾åƒä¸­æå–ç‰¹å¾åºåˆ—;
2.å¾ªç¯å±‚ï¼Œä½¿ç”¨RNNï¼Œä½œç”¨æ˜¯é¢„æµ‹ä»å·ç§¯å±‚è·å–çš„ç‰¹å¾åºåˆ—çš„æ ‡ç­¾ï¼ˆçœŸå®å€¼ï¼‰åˆ†å¸ƒ;
3.è½¬å½•å±‚ï¼Œä½¿ç”¨CTCï¼Œä½œç”¨æ˜¯æŠŠä»å¾ªç¯å±‚è·å–çš„æ ‡ç­¾åˆ†å¸ƒé€šè¿‡å»é‡æ•´åˆç­‰æ“ä½œè½¬æ¢æˆæœ€ç»ˆçš„è¯†åˆ«ç»“æœ;

![enter description here](https://github.com/amtls/MyImages/blob/master/%E6%9C%AA%E6%A0%87%E9%A2%98-1.jpg?raw=true)
## é¡¹ç›®ä¸­å¡å·å®šä½ä¸å¡å·è¯†åˆ«ç»“æœè¯´æ˜
>å¤§èµ›èµ„æ–™å›¾ç‰‡æµ‹è¯•ç»“æœ


>é¢å¤–å›¾ç‰‡æµ‹è¯•ç»“æœ
## é¡¹ç›®ä»£ç ä»‹ç»æ–‡æ¡£
##### é¡¹ç›®éƒ¨ç½²
>bank_card_ocr
	>>bin
	>>crnn:å¡å·è¯†åˆ«
	>>>modelsï¼šæ¨¡å‹æ–‡ä»¶
	>>>>_init_.py
	>>>>crnn.py
	>>>>
	>>>to_lmdb
	>>>>base.py
	>>>>base64.py
	>>>>dataset.py
	>>>>handle_images.py
	>>>>ocr.py:å¡å·å®šä½
	>>>>test.pyï¼šå¡å·å®šä½æµ‹è¯•
	>>>>train.pyï¼šæ¨¡å‹è®­ç»ƒ
	>>>>utils.pyï¼šå·¥å…·é›†
	>>dataï¼šé¢å¤–æµ‹è¯•æ•°æ®
	models
	test_imagesï¼šæµ‹è¯•å›¾ç‰‡é›†
	test_resultï¼šæµ‹è¯•ç»“æœé›†
	tool
	demo.pyï¼šé¡¹ç›®å¯åŠ¨æ–‡ä»¶
	config.pyï¼šé¡¹ç›®é…ç½®æ–‡ä»¶
	difflib.pyï¼š
##### é¡¹ç›®è¿è¡Œ
##### ä»£ç è¯´æ˜

